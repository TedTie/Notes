# æ–‡ä»¶ä¸Šä¼ 501é”™è¯¯è§£å†³æ–¹æ¡ˆ

## é—®é¢˜æè¿°

åœ¨Verceléƒ¨ç½²çš„åº”ç”¨ä¸­ï¼Œæ–‡ä»¶ä¸Šä¼ åŠŸèƒ½å‡ºç°501é”™è¯¯ï¼š

```
Failed to load resource: the server responded with a status of 501
[FRONTEND] Upload response status: 501
[FRONTEND] Upload failed: 501 - {"error":"File upload requires persistent storage","message":"Background upload not supported in Vercel environment"}
```

## é—®é¢˜åŸå› 

1. **Vercelæ— æœåŠ¡å™¨ç¯å¢ƒé™åˆ¶**ï¼šVercelçš„æ— æœåŠ¡å™¨å‡½æ•°ä¸æ”¯æŒæŒä¹…åŒ–æ–‡ä»¶å­˜å‚¨
2. **åŸå§‹å®ç°é—®é¢˜**ï¼šåº”ç”¨è¯•å›¾å°†æ–‡ä»¶ä¿å­˜åˆ°æœ¬åœ°æ–‡ä»¶ç³»ç»Ÿï¼Œè¿™åœ¨Vercelç¯å¢ƒä¸­ä¸å¯è¡Œ
3. **Supabaseé…ç½®é—®é¢˜**ï¼šSupabase Storageé…ç½®å­˜åœ¨é—®é¢˜ï¼Œå¯¼è‡´æ— æ³•æ­£å¸¸ä½¿ç”¨

## è§£å†³æ–¹æ¡ˆ

### æ–¹æ¡ˆ1ï¼šä½¿ç”¨æ–°çš„æ–‡ä»¶ä¸Šä¼ APIï¼ˆå·²å®æ–½ï¼‰

åˆ›å»ºäº†ä¸€ä¸ªæ–°çš„ä¸Šä¼ ç«¯ç‚¹ `/api/upload.py`ï¼Œä½¿ç”¨ä»¥ä¸‹ç­–ç•¥ï¼š

1. **Base64ç¼–ç è¿”å›**ï¼šå°†ä¸Šä¼ çš„æ–‡ä»¶è½¬æ¢ä¸ºBase64ç¼–ç çš„Data URL
2. **å†…å­˜å¤„ç†**ï¼šåœ¨å†…å­˜ä¸­å¤„ç†æ–‡ä»¶ï¼Œä¸å†™å…¥ç£ç›˜
3. **å³æ—¶è¿”å›**ï¼šç›´æ¥è¿”å›å¯ç”¨çš„Data URLç»™å‰ç«¯

#### å®æ–½æ­¥éª¤ï¼š

1. **åˆ›å»ºæ–°çš„æ–‡ä»¶ä¸Šä¼ æœåŠ¡**
   - æ–‡ä»¶ï¼š`ai-notebook/frontend/src/services/fileUploadService.js`
   - åŠŸèƒ½ï¼šå¤„ç†æ–‡ä»¶ä¸Šä¼ ã€è·å–èƒŒæ™¯åˆ—è¡¨ã€åˆ é™¤æ–‡ä»¶

2. **åˆ›å»ºæ–°çš„ä¸Šä¼ APIç«¯ç‚¹**
   - æ–‡ä»¶ï¼š`api/upload.py`
   - åŠŸèƒ½ï¼šæ¥æ”¶multipart/form-dataï¼Œè¿”å›Base64 Data URL

3. **æ›´æ–°å‰ç«¯ç»„ä»¶**
   - ä¿®æ”¹ï¼š`ai-notebook/frontend/src/components/Settings.vue`
   - å˜æ›´ï¼šä½¿ç”¨æ–°çš„æ–‡ä»¶ä¸Šä¼ æœåŠ¡æ›¿ä»£Supabase Storage

### æ–¹æ¡ˆ2ï¼šSupabase Storageï¼ˆå¤‡é€‰æ–¹æ¡ˆï¼‰

å¦‚æœéœ€è¦ä½¿ç”¨Supabase Storageï¼Œéœ€è¦ï¼š

1. **ä¿®å¤Supabaseé…ç½®**
   - æ›´æ–°æ­£ç¡®çš„ANON KEYå’ŒService Role Key
   - åˆ›å»ºå¿…è¦çš„å­˜å‚¨æ¡¶å’Œç­–ç•¥

2. **è®¾ç½®Vercelç¯å¢ƒå˜é‡**
   ```
   VITE_SUPABASE_URL=https://vcgythhenulnwuindgyx.supabase.co
   VITE_SUPABASE_ANON_KEY=æ­£ç¡®çš„åŒ¿åå¯†é’¥
   ```

3. **è¿è¡Œå­˜å‚¨æ¡¶åˆ›å»ºè„šæœ¬**
   ```bash
   node create-supabase-storage.js
   ```

## æŠ€æœ¯å®ç°ç»†èŠ‚

### æ–°ä¸Šä¼ APIçš„å·¥ä½œæµç¨‹

1. **æ¥æ”¶æ–‡ä»¶**ï¼šè§£æmultipart/form-dataæ ¼å¼çš„è¯·æ±‚
2. **éªŒè¯æ–‡ä»¶**ï¼šæ£€æŸ¥æ–‡ä»¶ç±»å‹å’Œå¤§å°é™åˆ¶
3. **å¤„ç†æ–‡ä»¶**ï¼šè¯»å–æ–‡ä»¶å†…å®¹åˆ°å†…å­˜
4. **ç¼–ç è¿”å›**ï¼šè½¬æ¢ä¸ºBase64 Data URLæ ¼å¼è¿”å›

### å‰ç«¯é›†æˆ

```javascript
// ä½¿ç”¨æ–°çš„æ–‡ä»¶ä¸Šä¼ æœåŠ¡
import fileUploadService from '../services/fileUploadService'

// ä¸Šä¼ æ–‡ä»¶
const result = await fileUploadService.uploadBackground(file)
console.log('ä¸Šä¼ ç»“æœ:', result.url) // Data URLæ ¼å¼
```

## ä¼˜åŠ¿ä¸é™åˆ¶

### ä¼˜åŠ¿

1. **Vercelå…¼å®¹**ï¼šå®Œå…¨å…¼å®¹Vercelæ— æœåŠ¡å™¨ç¯å¢ƒ
2. **å³æ—¶å¯ç”¨**ï¼šä¸Šä¼ åç«‹å³å¯ä»¥ä½¿ç”¨ï¼Œæ— éœ€é¢å¤–å­˜å‚¨
3. **ç®€å•å®ç°**ï¼šä¸ä¾èµ–å¤–éƒ¨å­˜å‚¨æœåŠ¡
4. **æ— é¢å¤–æˆæœ¬**ï¼šä¸éœ€è¦é¢å¤–çš„å­˜å‚¨æœåŠ¡è´¹ç”¨

### é™åˆ¶

1. **æ–‡ä»¶å¤§å°é™åˆ¶**ï¼šé€‚åˆä¸­å°å‹æ–‡ä»¶ï¼ˆå»ºè®®<10MBï¼‰
2. **å†…å­˜ä½¿ç”¨**ï¼šå¤§æ–‡ä»¶ä¼šå ç”¨è¾ƒå¤šå†…å­˜
3. **URLé•¿åº¦**ï¼šBase64ç¼–ç ä¼šå¢åŠ URLé•¿åº¦
4. **æŒä¹…åŒ–**ï¼šæ–‡ä»¶æ•°æ®å­˜å‚¨åœ¨åº”ç”¨çŠ¶æ€ä¸­ï¼Œåˆ·æ–°é¡µé¢ä¼šä¸¢å¤±

## éƒ¨ç½²çŠ¶æ€

âœ… **å·²å®Œæˆçš„ä¿®æ”¹**ï¼š
- åˆ›å»ºæ–°çš„æ–‡ä»¶ä¸Šä¼ æœåŠ¡
- åˆ›å»ºæ–°çš„ä¸Šä¼ APIç«¯ç‚¹
- æ›´æ–°å‰ç«¯ç»„ä»¶é›†æˆ
- æäº¤å¹¶æ¨é€åˆ°GitHub
- è§¦å‘Vercelè‡ªåŠ¨éƒ¨ç½²

ğŸ”„ **ä¸‹ä¸€æ­¥æ“ä½œ**ï¼š
1. ç­‰å¾…Verceléƒ¨ç½²å®Œæˆ
2. æµ‹è¯•æ–‡ä»¶ä¸Šä¼ åŠŸèƒ½
3. éªŒè¯èƒŒæ™¯è®¾ç½®åŠŸèƒ½
4. æ ¹æ®æµ‹è¯•ç»“æœè¿›è¡Œä¼˜åŒ–

## æµ‹è¯•å»ºè®®

1. **ä¸Šä¼ æµ‹è¯•**ï¼šå°è¯•ä¸Šä¼ ä¸åŒæ ¼å¼å’Œå¤§å°çš„å›¾ç‰‡æ–‡ä»¶
2. **åŠŸèƒ½æµ‹è¯•**ï¼šéªŒè¯èƒŒæ™¯è®¾ç½®å’Œåˆ‡æ¢åŠŸèƒ½
3. **æ€§èƒ½æµ‹è¯•**ï¼šæµ‹è¯•è¾ƒå¤§æ–‡ä»¶çš„ä¸Šä¼ æ€§èƒ½
4. **é”™è¯¯å¤„ç†**ï¼šæµ‹è¯•å„ç§é”™è¯¯æƒ…å†µçš„å¤„ç†

## æ•…éšœæ’é™¤

å¦‚æœä»ç„¶é‡åˆ°é—®é¢˜ï¼š

1. **æ£€æŸ¥æ§åˆ¶å°**ï¼šæŸ¥çœ‹æµè§ˆå™¨å¼€å‘è€…å·¥å…·çš„é”™è¯¯ä¿¡æ¯
2. **æ£€æŸ¥ç½‘ç»œ**ï¼šç¡®è®¤APIè¯·æ±‚æ˜¯å¦æ­£å¸¸å‘é€
3. **æ£€æŸ¥éƒ¨ç½²**ï¼šç¡®è®¤Verceléƒ¨ç½²æ˜¯å¦æˆåŠŸ
4. **æ£€æŸ¥ç¯å¢ƒå˜é‡**ï¼šç¡®è®¤Vercelç¯å¢ƒå˜é‡é…ç½®æ­£ç¡®

---

**æ›´æ–°æ—¶é—´**ï¼š2024å¹´1æœˆ
**çŠ¶æ€**ï¼šå·²å®æ–½å¹¶éƒ¨ç½²
**ä¸‹æ¬¡æ£€æŸ¥**ï¼šéƒ¨ç½²å®Œæˆåè¿›è¡ŒåŠŸèƒ½æµ‹è¯•