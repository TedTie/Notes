## 🤖 Assistant

明白了！感谢你提供这些关键的决策。你的选择非常务实且高效，我们将在经典的项目管理范式上，巧妙地注入 AI 的能力，而不是完全颠覆用户习惯。

这个方案可以总结为：**一个以传统看板为中心、多项目管理、通过悬浮 AI 助手进行智能增强的系统。** 这对于初学者来说，开发路径更清晰，也更容易被用户接受。

好的，现在我将根据你的选择，重新为你定制一份精确、专业的开发文档。

---

### **AI 项目管理功能 - 综合开发文档 (v1.5 - 定制版)**

### 1. 项目/功能概述 (Overview)

创建一个支持**多项目管理**的新页面。此页面的核心是一个**交互式看板 (Kanban Board)**，用户可以在此管理各个项目的任务。通过一个常驻的**悬浮 AI 助手**，用户可以随时调用 AI 对项目进行智能分解、任务细化和获取建议，将传统项目管理流程 AI 化。

### 2. 核心功能点 (Core Features)

* **多项目视图:**
 * 页面顶部有一个下拉菜单或标签页，用于在不同的项目之间切换（例如：“个人网站”、“学习 AI”、“健身计划”）。
 * 提供一个“创建新项目”的按钮。
* **经典看板布局:**
 * 每个项目都有一个专属的看板，包含“待办 (To Do)”、“进行中 (In Progress)”、“已完成 (Done)”三个标准泳道。
 * 用户可以手动创建任务卡片，并自由地在泳道间拖拽。
* **AI 增强按钮:**
 * **项目级别:** 在创建新项目时，用户只需填写项目名称（如“开发一个天气应用”），然后点击“**让 AI 规划任务**”按钮。AI 会自动分析目标，并在“待办”泳道中生成一系列初始任务。
 * **任务级别:** 每个任务卡片上都有一个小魔术棒 ✨ 图标，点击后会弹出菜单，提供 AI 增强选项，如：“**细化子任务**”、“**预估时间**”、“**分析风险**”。
* **悬浮 AI 助手:**
 * 右下角的悬浮球变身为一个“AI 小助手”。
 * **常规点击:** 像原来一样，打开一个全屏的通用聊天界面。
 * **主动建议:** 在特定场景下（例如，当一个任务在“进行中”停留太久），助手图标可能会轻微跳动，并弹出一个小的**对话气泡 (Speech Bubble)**，提供建议：“看起来‘设计 UI’任务遇到困难了，需要一些灵感或帮助吗？”
* **数据持久化:** 所有项目、任务和其状态都会被保存在后端数据库中。

### 3. 技术规格 (Technical Specifications)

#### **前端 (Frontend)**

* **页面/组件 (Pages/Components):**
 * **`ProjectView.vue` (新页面):**
 * 整体布局，包含项目选择器、看板区域和悬浮 AI 助手。
 * **`ProjectSelector.vue` (新组件):**
 * 顶部的下拉菜单或标签页，负责展示项目列表和切换当前项目。
 * **`KanbanBoard.vue` (新组件):**
 * 负责渲染所选项目的三个泳道和任务卡片。
 * 集成 **`vuedraggable`** 库以实现拖拽功能。
 * **`TaskCard.vue` (新组件):**
 * 显示任务标题。
 * 包含一个 ✨ 按钮，点击后显示一个包含“细化子任务”等选项的小菜单。
 * **`CreateProjectModal.vue` (新组件):**
 * 弹窗，用于创建新项目。包含一个项目名称输入框和一个“让 AI 规划任务”的按钮。
 * **`AiAssistantBubble.vue` (新组件):**
 * 绝对定位在右下角，负责显示悬浮球和在特定条件下弹出的对话气泡。

* **用户流程 (User Flow):**
 1. 用户进入页面，`ProjectSelector` 默认选中第一个项目，`KanbanBoard` 显示该项目的任务。
 2. 用户点击“创建新项目”，`CreateProjectModal` 弹出。
 3. 用户输入项目名称“学习 React”，然后点击“**让 AI 规划任务**”。
 4. 前端调用 `POST /api/projects`，请求体为 `{ "name": "学习 React", "use_ai_planning": true }`。
 5. 后端（在创建项目后）调用 OpenRouter 生成任务列表，并将它们与新项目一同存入数据库。
 6. 前端刷新项目列表，并自动切换到新创建的“学习 React”项目，看板上已布满了 AI 生成的任务。
 7. 用户将一个任务拖拽到“进行中”，前端调用 `PUT /api/tasks/{id}` 更新其状态。
* **数据交互 (Data Interaction):**
 * 页面加载: `GET /api/projects` 获取所有项目的列表。
 * 切换项目: `GET /api/projects/{id}/tasks` 获取该项目的所有任务。
 * AI 规划: `POST /api/projects` (如上所述)。
 * AI 任务细化: `POST /api/tasks/{id}/enhance`，请求体为 `{ "action": "breakdown" }`。后端会调用 AI 并返回生成的子任务或分析文本。

#### **后端 (Backend)**

* **AI 集成 (Prompt Engineering):**
 * **项目规划 Prompt:**
 ```
 "System: 你是一个项目规划专家。根据用户提供的项目名称，分解成一个 JSON 数组的任务。每个任务对象包含 'title' 和 'description'。
 User: 开发一个个人博客
 Assistant: [ { \"title\": \"数据库设计\", \"description\": \"设计用户表、文章表和评论表\" }, { \"title\": \"后端 API 开发\", \"description\": \"编写注册、登录、发布文章的接口\" }, ... ]"
 ```
 * **任务细化 Prompt:**
 ```
 "System: 你是一个资深开发者。根据用户提供的任务，将其分解为更小的、可执行的子步骤列表 (JSON 数组)。
 User: { \"title\": \"后端 API 开发\", \"description\": \"编写注册、登录、发布文章的接口\" }
 Assistant: [ { \"title\": \"实现 /api/register 接口\" }, { \"title\": \"实现 /api/login 接口\" }, ... ]"
 ```

* **API 接口 (API Endpoints):**
 * `GET /api/projects`: 获取所有项目列表 (id 和 name)。
 * `POST /api/projects`: 创建新项目。可接受一个布尔值 `use_ai_planning`。
 * `GET /api/projects/{id}/tasks`: 获取特定项目的所有任务。
 * `POST /api/tasks`: 手动创建一个新任务。
 * `PUT /api/tasks/{id}`: 更新任务（例如，通过拖拽更新 `status`）。
 * `POST /api/tasks/{id}/enhance`: 对特定任务执行 AI 增强操作。

* **数据模型 (Data Models - 与上一版相同):**
 * **`Projects` 表:** `id`, `name`。
 * **`Tasks` 表:** `id`, `project_id`, `title`, `description`, `status` ('todo', 'in_progress', 'done')。

### 4. 技术栈建议 (Tech Stack Suggestion)

* **前端:** Vue.js, `axios`, **`vuedraggable`**。
* **后端:** Python Flask, `requests`。

### 5. 开发步骤建议 (Development Steps)

1. **后端基础 (非 AI):**
 * 创建 `Projects` 和 `Tasks` 数据库表。
 * 实现所有非 AI 相关的 API：`GET /projects`, `POST /projects` (无 AI 版本), `GET /projects/{id}/tasks`, `POST /tasks`, `PUT /tasks/{id}`。

2. **前端骨架 (非 AI):**
 * 创建所有新组件的静态版本（用假数据）。
 * 实现项目选择器、手动创建任务、在泳道间拖拽任务的功能。**确保非 AI 的核心流程完全跑通。** 这是构建复杂功能最稳健的方法。

3. **集成“AI 规划”功能:**
 * 在后端 `POST /api/projects` 接口中，增加对 `use_ai_planning` 的处理逻辑：如果为 `true`，则调用 OpenRouter（使用“项目规划 Prompt”）生成任务并存入数据库。
 * 在前端 `CreateProjectModal` 中连接此功能。

4. **集成“AI 任务细化”功能:**
 * 实现后端的 `POST /api/tasks/{id}/enhance` 接口。
 * 在前端 `TaskCard` 组件上添加 ✨ 按钮和菜单，并调用此接口。思考如何展示 AI 返回的细化结果（例如，在任务详情弹窗中显示一个子任务列表）。

5. **开发悬浮 AI 助手:**
 * 创建 `AiAssistantBubble.vue` 组件并将其放置在主布局中。
 * 首先，只实现点击打开通用聊天页面的功能。
 * 然后，增加“主动建议”的逻辑。这可以是一个简单的定时器：在前端检测到一个任务在“进行中”状态超过一定时间（例如 1 小时），就触发 `AiAssistantBubble` 显示建议气泡。

6. **打磨与测试:**
 * 为 AI 调用过程添加加载指示器 (loading spinners)，提升用户体验。
 * 全面测试多项目切换时数据的正确性。
 * 优化所有 UI 交互和视觉效果。

这个版本的设计既保留了传统项目管理的直观性，又通过 AI 赋予了它“智慧”。按照这个步骤，你可以逐步构建出这个强大的功能。我们先从打好非 AI 的基础开始，这会让后续的开发工作事半功倍。
